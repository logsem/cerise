<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="./">Project Page</a>
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> Table of Contents </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">cap_machine.exercises.subseg_buffer</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.algebra</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">frac</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.proofmode</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">tactics</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Logic.Eqdep_dec.html#"><span class="id" title="library">Eqdep_dec</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#"><span class="id" title="library">List</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">cap_machine</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="cap_machine.examples.malloc.html#"><span class="id" title="library">malloc</span></a> <a class="idref" href="cap_machine.examples.macros.html#"><span class="id" title="library">macros</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">cap_machine</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="cap_machine.fundamental.html#"><span class="id" title="library">fundamental</span></a> <a class="idref" href="cap_machine.logrel.html#"><span class="id" title="library">logrel</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">cap_machine.proofmode</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="cap_machine.proofmode.tactics_helpers.html#"><span class="id" title="library">tactics_helpers</span></a> <a class="idref" href="cap_machine.proofmode.proofmode.html#"><span class="id" title="library">proofmode</span></a> <a class="idref" href="cap_machine.proofmode.register_tactics.html#"><span class="id" title="library">register_tactics</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">cap_machine.examples</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="cap_machine.examples.template_adequacy.html#"><span class="id" title="library">template_adequacy</span></a>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>

<br/>
</div>

<div class="doc">
Exercise - the region is already allocated and the capability pointing to this
    region is in R1. As a first step, the adversary code is known and just halts. 
</div>
<div class="code">
<span class="id" title="keyword">Section</span> <a id="base_program" class="idref" href="#base_program"><span class="id" title="section">base_program</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="0101b9beac487b383a5ba2a8f6922788" class="idref" href="#0101b9beac487b383a5ba2a8f6922788"><span class="id" title="binder">Σ</span></a>:<span class="id" title="record">gFunctors</span>} {<a id="memg:2" class="idref" href="#memg:2"><span class="id" title="binder">memg</span></a>:<a class="idref" href="cap_machine.rules.rules_base.html#memG"><span class="id" title="class">memG</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#0101b9beac487b383a5ba2a8f6922788"><span class="id" title="variable">Σ</span></a>} {<a id="regg:3" class="idref" href="#regg:3"><span class="id" title="binder">regg</span></a>:<a class="idref" href="cap_machine.rules.rules_base.html#regG"><span class="id" title="class">regG</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#0101b9beac487b383a5ba2a8f6922788"><span class="id" title="variable">Σ</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="MP:4" class="idref" href="#MP:4"><span class="id" title="binder">MP</span></a>: <a class="idref" href="cap_machine.machine_parameters.html#MachineParameters"><span class="id" title="class">MachineParameters</span></a>}.<br/>

<br/>
</div>

<div class="doc">
`r_mem` is the register that contains the capability pointing to
      the allocated buffer:
<ul class="doclist">
<li> `secret_off` is the offset of the secret in the buffer

</li>
<li> `secret` is the value stored in the buffer

</li>
</ul>
   
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="prog_base_instrs" class="idref" href="#prog_base_instrs"><span class="id" title="definition">prog_base_instrs</span></a> <a id="r_mem:5" class="idref" href="#r_mem:5"><span class="id" title="binder">r_mem</span></a> (<a id="secret_off:6" class="idref" href="#secret_off:6"><span class="id" title="binder">secret_off</span></a> <a id="secret:7" class="idref" href="#secret:7"><span class="id" title="binder">secret</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="cap_machine.machine_base.html#Word"><span class="id" title="inductive">Word</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cap_machine.machine_parameters.html#encodeInstrsW"><span class="id" title="definition">encodeInstrsW</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cap_machine.machine_base.html#Lea"><span class="id" title="constructor">Lea</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#r_mem:5"><span class="id" title="variable">r_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:6"><span class="id" title="variable">secret_off</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cap_machine.machine_base.html#Store"><span class="id" title="constructor">Store</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#r_mem:5"><span class="id" title="variable">r_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:7"><span class="id" title="variable">secret</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cap_machine.machine_base.html#GetB"><span class="id" title="constructor">GetB</span></a> <a class="idref" href="cap_machine.addr_reg.html#r_t2"><span class="id" title="definition">r_t2</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#r_mem:5"><span class="id" title="variable">r_mem</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cap_machine.machine_base.html#GetE"><span class="id" title="constructor">GetE</span></a> <a class="idref" href="cap_machine.addr_reg.html#r_t3"><span class="id" title="definition">r_t3</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#r_mem:5"><span class="id" title="variable">r_mem</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cap_machine.machine_base.html#Add"><span class="id" title="constructor">Add</span></a> <a class="idref" href="cap_machine.addr_reg.html#r_t2"><span class="id" title="definition">r_t2</span></a> <a class="idref" href="cap_machine.addr_reg.html#r_t2"><span class="id" title="definition">r_t2</span></a> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:6"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1)<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cap_machine.machine_base.html#Subseg"><span class="id" title="constructor">Subseg</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#r_mem:5"><span class="id" title="variable">r_mem</span></a> <a class="idref" href="cap_machine.addr_reg.html#r_t2"><span class="id" title="definition">r_t2</span></a> <a class="idref" href="cap_machine.addr_reg.html#r_t3"><span class="id" title="definition">r_t3</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a>.<br/>

<br/>
</div>

<div class="doc">
Jump to the adversary in register `r30` at the end of the program 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="prog_code" class="idref" href="#prog_code"><span class="id" title="definition">prog_code</span></a> <a id="secret_off:8" class="idref" href="#secret_off:8"><span class="id" title="binder">secret_off</span></a> <a id="secret_val:9" class="idref" href="#secret_val:9"><span class="id" title="binder">secret_val</span></a>: <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="cap_machine.machine_base.html#Word"><span class="id" title="inductive">Word</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cap_machine.exercises.subseg_buffer.html#prog_base_instrs"><span class="id" title="definition">prog_base_instrs</span></a> <a class="idref" href="cap_machine.addr_reg.html#r_t1"><span class="id" title="definition">r_t1</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:8"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_val:9"><span class="id" title="variable">secret_val</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="cap_machine.machine_parameters.html#encodeInstrsW"><span class="id" title="definition">encodeInstrsW</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="cap_machine.machine_base.html#Jmp"><span class="id" title="constructor">Jmp</span></a> <a class="idref" href="cap_machine.addr_reg.html#r_t30"><span class="id" title="definition">r_t30</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>.<br/>

<br/>
</div>

<div class="doc">
The adversary code is known --- it just halts 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="adv_code" class="idref" href="#adv_code"><span class="id" title="definition">adv_code</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="cap_machine.machine_base.html#Word"><span class="id" title="inductive">Word</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cap_machine.machine_parameters.html#encodeInstrsW"><span class="id" title="definition">encodeInstrsW</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a> <a class="idref" href="cap_machine.machine_base.html#Halt"><span class="id" title="constructor">Halt</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>.<br/>

<br/>
</div>

<div class="doc">
Specification of :
<ul class="doclist">
<li> executes the first part

</li>
<li> jump to the adversary

</li>
<li> halts

</li>
</ul>
   
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="prog_spec" class="idref" href="#prog_spec"><span class="id" title="lemma">prog_spec</span></a> (<a id="a_adv:10" class="idref" href="#a_adv:10"><span class="id" title="binder">a_adv</span></a> : <a class="idref" href="cap_machine.addr_reg.html#Addr"><span class="id" title="abbreviation">Addr</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="p_pc:11" class="idref" href="#p_pc:11"><span class="id" title="binder">p_pc</span></a> <a id="b_pc:12" class="idref" href="#b_pc:12"><span class="id" title="binder">b_pc</span></a> <a id="e_pc:13" class="idref" href="#e_pc:13"><span class="id" title="binder">e_pc</span></a> <a id="a_prog:14" class="idref" href="#a_prog:14"><span class="id" title="binder">a_prog</span></a> <span class="comment">(*&nbsp;pc&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="p_mem:15" class="idref" href="#p_mem:15"><span class="id" title="binder">p_mem</span></a> (<a id="b_mem:16" class="idref" href="#b_mem:16"><span class="id" title="binder">b_mem</span></a> <a id="e_mem:17" class="idref" href="#e_mem:17"><span class="id" title="binder">e_mem</span></a>: <a class="idref" href="cap_machine.addr_reg.html#Addr"><span class="id" title="abbreviation">Addr</span></a>) <span class="comment">(*&nbsp;mem&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="secret_off:18" class="idref" href="#secret_off:18"><span class="id" title="binder">secret_off</span></a> <a id="secret_val:19" class="idref" href="#secret_val:19"><span class="id" title="binder">secret_val</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="w2:20" class="idref" href="#w2:20"><span class="id" title="binder">w2</span></a> <a id="w3:21" class="idref" href="#w3:21"><span class="id" title="binder">w3</span></a> <span class="id" title="projection">:</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="secret:22" class="idref" href="#secret:22"><span class="id" title="binder">secret</span></a> := (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:16"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:18"><span class="id" title="variable">secret_off</span></a>)%<span class="id" title="var">a</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="len_p:23" class="idref" href="#len_p:23"><span class="id" title="binder">len_p</span></a> := (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_prog:14"><span class="id" title="variable">a_prog</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <span class="id" title="abbreviation">length</span> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#prog_code"><span class="id" title="definition">prog_code</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:18"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_val:19"><span class="id" title="variable">secret_val</span></a>))%<span class="id" title="var">a</span> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cap_machine.machine_base.html#ExecPCPerm"><span class="id" title="definition">ExecPCPerm</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#p_pc:11"><span class="id" title="variable">p_pc</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="machine_utils.finz_base.html#SubBounds"><span class="id" title="definition">SubBounds</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_pc:12"><span class="id" title="variable">b_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_pc:13"><span class="id" title="variable">e_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_prog:14"><span class="id" title="variable">a_prog</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#len_p:23"><span class="id" title="variable">len_p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:16"><span class="id" title="variable">b_mem</span></a> <span class="id" title="notation">≤</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:22"><span class="id" title="variable">secret</span></a> <span class="id" title="notation">&lt;</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:17"><span class="id" title="variable">e_mem</span></a>)%<span class="id" title="var">a</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cap_machine.machine_base.html#writeAllowed"><span class="id" title="definition">writeAllowed</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#p_mem:15"><span class="id" title="variable">p_mem</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">⊢</span> ( <span class="comment">(*&nbsp;PC&nbsp;points&nbsp;to&nbsp;`prog_code`&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cap_machine.addr_reg.html#PC"><span class="id" title="constructor">PC</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.machine_base.html#WCap"><span class="id" title="abbreviation">WCap</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#p_pc:11"><span class="id" title="variable">p_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_pc:12"><span class="id" title="variable">b_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_pc:13"><span class="id" title="variable">e_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_prog:14"><span class="id" title="variable">a_prog</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.proofmode.region.html#codefrag"><span class="id" title="definition">codefrag</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_prog:14"><span class="id" title="variable">a_prog</span></a> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#prog_code"><span class="id" title="definition">prog_code</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:18"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_val:19"><span class="id" title="variable">secret_val</span></a>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;r1&nbsp;points&nbsp;to&nbsp;the&nbsp;allocated&nbsp;memory&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.addr_reg.html#r_t1"><span class="id" title="definition">r_t1</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.machine_base.html#WCap"><span class="id" title="abbreviation">WCap</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#p_mem:15"><span class="id" title="variable">p_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:16"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:17"><span class="id" title="variable">e_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:16"><span class="id" title="variable">b_mem</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;which&nbsp;is&nbsp;filled&nbsp;by&nbsp;zeroes&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">[[</span></a><a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:16"><span class="id" title="variable">b_mem</span></a><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">,</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:17"><span class="id" title="variable">e_mem</span></a><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">]]</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">↦ₐ</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">[[</span></a> <a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:16"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:17"><span class="id" title="variable">e_mem</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">]]</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;r30&nbsp;point&nbsp;to&nbsp;the&nbsp;adversary&nbsp;code&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.addr_reg.html#r_t30"><span class="id" title="definition">r_t30</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.machine_base.html#WCap"><span class="id" title="abbreviation">WCap</span></a> <a class="idref" href="cap_machine.machine_base.html#E"><span class="id" title="constructor">E</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_adv:10"><span class="id" title="variable">a_adv</span></a> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_adv:10"><span class="id" title="variable">a_adv</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">(</span></a><span class="id" title="abbreviation">length</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#adv_code"><span class="id" title="definition">adv_code</span></a><a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">a</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_adv:10"><span class="id" title="variable">a_adv</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.proofmode.region.html#codefrag"><span class="id" title="definition">codefrag</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_adv:10"><span class="id" title="variable">a_adv</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#adv_code"><span class="id" title="definition">adv_code</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.addr_reg.html#r_t2"><span class="id" title="definition">r_t2</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#w2:20"><span class="id" title="variable">w2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.addr_reg.html#r_t3"><span class="id" title="definition">r_t3</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#w3:21"><span class="id" title="variable">w3</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">-∗</span> <span class="id" title="notation">WP</span> <a class="idref" href="cap_machine.cap_lang.html#Seq"><span class="id" title="constructor">Seq</span></a> (<a class="idref" href="cap_machine.cap_lang.html#Instr"><span class="id" title="constructor">Instr</span></a> <a class="idref" href="cap_machine.cap_lang.html#Executable"><span class="id" title="constructor">Executable</span></a>) <span class="id" title="notation">{{</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">λ</span></a> <a id="v:24" class="idref" href="#v:24"><span class="id" title="binder">v</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">,</span></a> <span class="id" title="notation">⌜</span><a class="idref" href="cap_machine.exercises.subseg_buffer.html#v:24"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cap_machine.cap_lang.html#HaltedV"><span class="id" title="constructor">HaltedV</span></a><span class="id" title="notation">⌝</span> <span class="id" title="notation">-∗</span> <span class="comment">(*&nbsp;The&nbsp;machine&nbsp;is&nbsp;halted&nbsp;after&nbsp;the&nbsp;adversary&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cap_machine.addr_reg.html#r_t1"><span class="id" title="definition">r_t1</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.machine_base.html#WCap"><span class="id" title="abbreviation">WCap</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#p_mem:15"><span class="id" title="variable">p_mem</span></a> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:16"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">(</span></a><a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:18"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1<a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">a</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:17"><span class="id" title="variable">e_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:22"><span class="id" title="variable">secret</span></a>%<span class="id" title="var">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.addr_reg.html#r_t2"><span class="id" title="definition">r_t2</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.machine_base.html#WInt"><span class="id" title="constructor">WInt</span></a> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:16"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">(</span></a><a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:18"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">)</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.addr_reg.html#r_t3"><span class="id" title="definition">r_t3</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.machine_base.html#WInt"><span class="id" title="constructor">WInt</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:17"><span class="id" title="variable">e_mem</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.proofmode.region.html#codefrag"><span class="id" title="definition">codefrag</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_prog:14"><span class="id" title="variable">a_prog</span></a> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#prog_code"><span class="id" title="definition">prog_code</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:18"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_val:19"><span class="id" title="variable">secret_val</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.proofmode.region.html#codefrag"><span class="id" title="definition">codefrag</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_adv:10"><span class="id" title="variable">a_adv</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#adv_code"><span class="id" title="definition">adv_code</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:22"><span class="id" title="variable">secret</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#e389c97555835874498bb08a394266c6"><span class="id" title="notation">↦ₐ</span></a> <a class="idref" href="cap_machine.machine_base.html#WInt"><span class="id" title="constructor">WInt</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_val:19"><span class="id" title="variable">secret_val</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">[[</span></a><a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:16"><span class="id" title="variable">b_mem</span></a><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">,</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:22"><span class="id" title="variable">secret</span></a><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">]]</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">↦ₐ</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">[[</span></a> <a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:16"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:22"><span class="id" title="variable">secret</span></a><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">]]</span></a><br/>
                     <span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">[[</span></a>(<a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:22"><span class="id" title="variable">secret</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> 1)%<span class="id" title="var">a</span><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">,</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:17"><span class="id" title="variable">e_mem</span></a><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">]]</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">↦ₐ</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">[[</span></a> <a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:22"><span class="id" title="variable">secret</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> 1)%<span class="id" title="var">a</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:17"><span class="id" title="variable">e_mem</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">]]</span></a><br/>
      <span class="id" title="notation">}}</span>)%<span class="id" title="var">I</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">Hpc_perm</span> <span class="id" title="var">Hpc_bounds</span> <span class="id" title="var">Hlen_mem</span> <span class="id" title="var">Hp_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(HPC &amp; Hprog &amp; Hr1 &amp; Hmem &amp; Hr30 &amp; Hadv &amp; Hr2 &amp; Hr3)".<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;1&nbsp;-&nbsp;prepare&nbsp;the&nbsp;assertions&nbsp;for&nbsp;the&nbsp;proof&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">secret</span> <span class="id" title="var">len_p</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Derives&nbsp;the&nbsp;facts&nbsp;from&nbsp;the&nbsp;codefrag&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">codefrag_facts</span> "Hprog".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">codefrag_facts</span> "Hadv".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="cap_machine.exercises.subseg_buffer.html#prog_code"><span class="id" title="definition">prog_code</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;This&nbsp;assertion&nbsp;will&nbsp;be&nbsp;helpful&nbsp;seeral&nbsp;times&nbsp;during&nbsp;the&nbsp;proof&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Hp_mem'</span>: <span class="id" title="var">p_mem</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#eac9b9307401b34847f15ea69bb5957f"><span class="id" title="notation">≠</span></a> <a class="idref" href="cap_machine.machine_base.html#E"><span class="id" title="constructor">E</span></a>). {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> -&gt;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hp_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;2&nbsp;-&nbsp;Use&nbsp;the&nbsp;WP&nbsp;rules&nbsp;for&nbsp;each&nbsp;instructions&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Lea&nbsp;r_t1&nbsp;3&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iInstr</span> "Hprog".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">transitivity</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<span class="id" title="var">b_mem</span> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <span class="id" title="var">secret_off</span>)%<span class="id" title="var">a</span>); <span class="id" title="var">solve_addr</span> +<span class="id" title="var">Hlen_mem</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Store&nbsp;r_t1&nbsp;42,&nbsp;where&nbsp;r_t1&nbsp;=&nbsp;(RWX,&nbsp;b,&nbsp;e,&nbsp;secret)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;store&nbsp;requires&nbsp;the&nbsp;resource&nbsp;`secret&nbsp;↦ₐ&nbsp;w`&nbsp;for&nbsp;some&nbsp;w,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;thus&nbsp;extract&nbsp;the&nbsp;resource&nbsp;from&nbsp;the&nbsp;memory&nbsp;buffer&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes_split"><span class="id" title="axiom">region_addrs_zeroes_split</span></a> <span class="id" title="var">b_mem</span> (<span class="id" title="var">b_mem</span> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <span class="id" title="var">secret_off</span>)%<span class="id" title="var">a</span> <span class="id" title="var">e_mem</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[| <span class="id" title="var">solve_addr</span> +<span class="id" title="var">Hlen_mem</span> ].<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="cap_machine.proofmode.region.html#region_mapsto_split"><span class="id" title="axiom">region_mapsto_split</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">b_mem</span> <span class="id" title="var">e_mem</span> (<span class="id" title="var">b_mem</span> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <span class="id" title="var">secret_off</span>)%<span class="id" title="var">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a> <span class="id" title="var">b_mem</span> (<span class="id" title="var">b_mem</span> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <span class="id" title="var">secret_off</span>)%<span class="id" title="var">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a> (<span class="id" title="var">b_mem</span> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <span class="id" title="var">secret_off</span>)%<span class="id" title="var">a</span> <span class="id" title="var">e_mem</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">with</span> "Hmem"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "[Hmem Hmem']".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">solve_addr</span> +<span class="id" title="var">Hlen_mem</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">unfold</span> <a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">replicate_length</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a> <span class="id" title="tactic">at</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="machine_utils.finz_interval.html#finz_dist_S"><span class="id" title="lemma">finz_dist_S</span></a>; [| <span class="id" title="var">solve_addr</span> +<span class="id" title="var">Hlen_mem</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">replicate_S</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="cap_machine.proofmode.region.html#region_mapsto_cons"><span class="id" title="axiom">region_mapsto_cons</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">b_mem</span> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <span class="id" title="var">secret_off</span>)%<span class="id" title="var">a</span> <span class="id" title="var">_</span> <span class="id" title="var">e_mem</span> (<a class="idref" href="cap_machine.machine_base.html#WInt"><span class="id" title="constructor">WInt</span></a> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a> <span class="id" title="var">_</span> <span class="id" title="var">e_mem</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">with</span> "Hmem'"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "[Hsecret Hmem']".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">transitivity</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<span class="id" title="var">b_mem</span> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">(</span></a><span class="id" title="var">secret_off</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1<a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">a</span>); <span class="id" title="var">solve_addr</span> +<span class="id" title="var">Hlen_mem</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">solve_addr</span> +<span class="id" title="var">Hlen_mem</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;that&nbsp;we&nbsp;have&nbsp;the&nbsp;secret&nbsp;address,&nbsp;we&nbsp;can&nbsp;continue&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iInstr</span> "Hprog".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">solve_addr</span> +<span class="id" title="var">Hlen_mem</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;getB,&nbsp;getE,&nbsp;add,&nbsp;subseg&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iGo</span> "Hprog".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">transitivity</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<span class="id" title="var">b_mem</span> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">(</span></a><span class="id" title="var">secret_off</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1<a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">a</span>); <span class="id" title="var">solve_addr</span> +<span class="id" title="var">Hlen_mem</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">solve_addr</span> +<span class="id" title="var">Hlen_mem</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;jmp&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iInstr</span> "Hprog".<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;halts&nbsp;in&nbsp;the&nbsp;adversary&nbsp;code&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="cap_machine.exercises.subseg_buffer.html#adv_code"><span class="id" title="definition">adv_code</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iInstr</span> "Hadv".<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;3&nbsp;-&nbsp;The&nbsp;machine&nbsp;is&nbsp;halted,&nbsp;prove&nbsp;that&nbsp;the&nbsp;post&nbsp;condition&nbsp;holds&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wp_end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "_".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">(</span></a><span class="id" title="var">b_mem</span> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <span class="id" title="var">secret_off</span><a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">)</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> 1)%<span class="id" title="var">a</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">b_mem</span> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">(</span></a><span class="id" title="var">secret_off</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1<a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">a</span> <span class="id" title="tactic">by</span> <span class="id" title="var">solve_addr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iFrame</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Unshelve</span>. <span class="id" title="var">Fail</span> <span class="id" title="tactic">idtac</span>. <span class="id" title="var">Admitted</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#base_program"><span class="id" title="section">base_program</span></a>.<br/>

<br/>
</div>

<div class="doc">
We use a CPS specification. We don't know the adversary code,
    thus we stop the specification after the jump. We give only the necessary
    resources. 
</div>
<div class="code">
<span class="id" title="keyword">Section</span> <a id="base_program_CPS" class="idref" href="#base_program_CPS"><span class="id" title="section">base_program_CPS</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="7fd4a516bfc23c1706437f236b640793" class="idref" href="#7fd4a516bfc23c1706437f236b640793"><span class="id" title="binder">Σ</span></a>:<span class="id" title="record">gFunctors</span>} {<a id="memg:26" class="idref" href="#memg:26"><span class="id" title="binder">memg</span></a>:<a class="idref" href="cap_machine.rules.rules_base.html#memG"><span class="id" title="class">memG</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#7fd4a516bfc23c1706437f236b640793"><span class="id" title="variable">Σ</span></a>} {<a id="regg:27" class="idref" href="#regg:27"><span class="id" title="binder">regg</span></a>:<a class="idref" href="cap_machine.rules.rules_base.html#regG"><span class="id" title="class">regG</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#7fd4a516bfc23c1706437f236b640793"><span class="id" title="variable">Σ</span></a>} {<a id="sealsg:28" class="idref" href="#sealsg:28"><span class="id" title="binder">sealsg</span></a> : <a class="idref" href="cap_machine.seal_store.html#sealStoreG"><span class="id" title="class">sealStoreG</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#7fd4a516bfc23c1706437f236b640793"><span class="id" title="variable">Σ</span></a>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<a id="MP:29" class="idref" href="#MP:29"><span class="id" title="binder">MP</span></a>: <a class="idref" href="cap_machine.machine_parameters.html#MachineParameters"><span class="id" title="class">MachineParameters</span></a>}.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;For&nbsp;a&nbsp;clearer&nbsp;context,&nbsp;we&nbsp;will&nbsp;use&nbsp;these&nbsp;following&nbsp;notations&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Note&nbsp;that&nbsp;the&nbsp;invocation&nbsp;of&nbsp;`solve_addr`&nbsp;will&nbsp;be&nbsp;done&nbsp;with&nbsp;the&nbsp;full&nbsp;Coq&nbsp;context&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Therefore,&nbsp;these&nbsp;tactics&nbsp;will&nbsp;require&nbsp;more&nbsp;computation.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Tactic Notation</span> "solve_addr'" :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> <span class="id" title="var">x</span> := <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">subst</span> <span class="id" title="var">x</span> <span class="id" title="keyword">end</span>); <span class="id" title="var">solve_addr</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Tactic Notation</span> "iGo'" <span class="id" title="keyword">constr</span>(<span class="id" title="var">H</span>) := <span class="id" title="tactic">repeat</span> (<span class="id" title="var">iGo</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">solve_addr'</span>).<br/>

<br/>
</div>

<div class="doc">
Specification of the program before the jump to the adversary.
      The specification and the proof are essentially the same as the
      previous one. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="prog_base_spec" class="idref" href="#prog_base_spec"><span class="id" title="lemma">prog_base_spec</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="r_mem:30" class="idref" href="#r_mem:30"><span class="id" title="binder">r_mem</span></a> <a id="secret_off:31" class="idref" href="#secret_off:31"><span class="id" title="binder">secret_off</span></a> <a id="secret:32" class="idref" href="#secret:32"><span class="id" title="binder">secret</span></a> <span class="comment">(*&nbsp;instantiation&nbsp;prog_base&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="p_pc:33" class="idref" href="#p_pc:33"><span class="id" title="binder">p_pc</span></a> <a id="b_pc:34" class="idref" href="#b_pc:34"><span class="id" title="binder">b_pc</span></a> <a id="e_pc:35" class="idref" href="#e_pc:35"><span class="id" title="binder">e_pc</span></a> <a id="s_prog:36" class="idref" href="#s_prog:36"><span class="id" title="binder">s_prog</span></a> <span class="comment">(*&nbsp;pc&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="p_mem:37" class="idref" href="#p_mem:37"><span class="id" title="binder">p_mem</span></a> (<a id="b_mem:38" class="idref" href="#b_mem:38"><span class="id" title="binder">b_mem</span></a> <a id="e_mem:39" class="idref" href="#e_mem:39"><span class="id" title="binder">e_mem</span></a> : <a class="idref" href="cap_machine.addr_reg.html#Addr"><span class="id" title="abbreviation">Addr</span></a>) <span class="comment">(*&nbsp;mem&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="w2:40" class="idref" href="#w2:40"><span class="id" title="binder">w2</span></a> <a id="w3:41" class="idref" href="#w3:41"><span class="id" title="binder">w3</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="de6e3fe6143317c8657dfe79764a6915" class="idref" href="#de6e3fe6143317c8657dfe79764a6915"><span class="id" title="binder">φ</span></a> :<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="e_prog:43" class="idref" href="#e_prog:43"><span class="id" title="binder">e_prog</span></a> := (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#s_prog:36"><span class="id" title="variable">s_prog</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <span class="id" title="abbreviation">length</span> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#prog_base_instrs"><span class="id" title="definition">prog_base_instrs</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#r_mem:30"><span class="id" title="variable">r_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:31"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:32"><span class="id" title="variable">secret</span></a>))%<span class="id" title="var">a</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="a_secret:44" class="idref" href="#a_secret:44"><span class="id" title="binder">a_secret</span></a> := (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:38"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:31"><span class="id" title="variable">secret_off</span></a>)%<span class="id" title="var">a</span> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Validity&nbsp;pc&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cap_machine.machine_base.html#ExecPCPerm"><span class="id" title="definition">ExecPCPerm</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#p_pc:33"><span class="id" title="variable">p_pc</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="machine_utils.finz_base.html#SubBounds"><span class="id" title="definition">SubBounds</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_pc:34"><span class="id" title="variable">b_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_pc:35"><span class="id" title="variable">e_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#s_prog:36"><span class="id" title="variable">s_prog</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_prog:43"><span class="id" title="variable">e_prog</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Validity&nbsp;buffer&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;( <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:38"><span class="id" title="variable">b_mem</span></a> <span class="id" title="notation">≤</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_secret:44"><span class="id" title="variable">a_secret</span></a> <span class="id" title="notation">&lt;</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:39"><span class="id" title="variable">e_mem</span></a>)%<span class="id" title="var">a</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cap_machine.machine_base.html#writeAllowed"><span class="id" title="definition">writeAllowed</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#p_mem:37"><span class="id" title="variable">p_mem</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Specification&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">⊢</span> (<span class="id" title="notation">(</span> <a class="idref" href="cap_machine.addr_reg.html#PC"><span class="id" title="constructor">PC</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.machine_base.html#WCap"><span class="id" title="abbreviation">WCap</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#p_pc:33"><span class="id" title="variable">p_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_pc:34"><span class="id" title="variable">b_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_pc:35"><span class="id" title="variable">e_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#s_prog:36"><span class="id" title="variable">s_prog</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#r_mem:30"><span class="id" title="variable">r_mem</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.machine_base.html#WCap"><span class="id" title="abbreviation">WCap</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#p_mem:37"><span class="id" title="variable">p_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:38"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:39"><span class="id" title="variable">e_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:38"><span class="id" title="variable">b_mem</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.addr_reg.html#r_t2"><span class="id" title="definition">r_t2</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#w2:40"><span class="id" title="variable">w2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.addr_reg.html#r_t3"><span class="id" title="definition">r_t3</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#w3:41"><span class="id" title="variable">w3</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">[[</span></a><a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:38"><span class="id" title="variable">b_mem</span></a><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">,</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:39"><span class="id" title="variable">e_mem</span></a><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">]]</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">↦ₐ</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">[[</span></a> <a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:38"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:39"><span class="id" title="variable">e_mem</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">]]</span></a><br/>
         <span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.proofmode.region.html#codefrag"><span class="id" title="definition">codefrag</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#s_prog:36"><span class="id" title="variable">s_prog</span></a> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#prog_base_instrs"><span class="id" title="definition">prog_base_instrs</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#r_mem:30"><span class="id" title="variable">r_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:31"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:32"><span class="id" title="variable">secret</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <span class="id" title="notation">▷</span> <span class="id" title="notation">(</span> <a class="idref" href="cap_machine.addr_reg.html#PC"><span class="id" title="constructor">PC</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.machine_base.html#WCap"><span class="id" title="abbreviation">WCap</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#p_pc:33"><span class="id" title="variable">p_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_pc:34"><span class="id" title="variable">b_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_pc:35"><span class="id" title="variable">e_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_prog:43"><span class="id" title="variable">e_prog</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#r_mem:30"><span class="id" title="variable">r_mem</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.machine_base.html#WCap"><span class="id" title="abbreviation">WCap</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#p_mem:37"><span class="id" title="variable">p_mem</span></a> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_secret:44"><span class="id" title="variable">a_secret</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> 1)%<span class="id" title="var">a</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:39"><span class="id" title="variable">e_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_secret:44"><span class="id" title="variable">a_secret</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.addr_reg.html#r_t2"><span class="id" title="definition">r_t2</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.machine_base.html#WInt"><span class="id" title="constructor">WInt</span></a> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:38"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:31"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.addr_reg.html#r_t3"><span class="id" title="definition">r_t3</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.machine_base.html#WInt"><span class="id" title="constructor">WInt</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:39"><span class="id" title="variable">e_mem</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">[[</span></a><a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:38"><span class="id" title="variable">b_mem</span></a><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">,</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_secret:44"><span class="id" title="variable">a_secret</span></a><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">]]</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">↦ₐ</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">[[</span></a> <a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:38"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_secret:44"><span class="id" title="variable">a_secret</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">]]</span></a><br/>
               <span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_secret:44"><span class="id" title="variable">a_secret</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#e389c97555835874498bb08a394266c6"><span class="id" title="notation">↦ₐ</span></a> <a class="idref" href="cap_machine.machine_base.html#WInt"><span class="id" title="constructor">WInt</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:32"><span class="id" title="variable">secret</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">[[</span></a>(<a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_secret:44"><span class="id" title="variable">a_secret</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> 1)%<span class="id" title="var">a</span><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">,</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:39"><span class="id" title="variable">e_mem</span></a><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">]]</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">↦ₐ</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">[[</span></a> <a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_secret:44"><span class="id" title="variable">a_secret</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> 1)%<span class="id" title="var">a</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:39"><span class="id" title="variable">e_mem</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">]]</span></a><br/>
               <span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.proofmode.region.html#codefrag"><span class="id" title="definition">codefrag</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#s_prog:36"><span class="id" title="variable">s_prog</span></a> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#prog_base_instrs"><span class="id" title="definition">prog_base_instrs</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#r_mem:30"><span class="id" title="variable">r_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:31"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:32"><span class="id" title="variable">secret</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">-∗</span> <span class="id" title="notation">WP</span> <a class="idref" href="cap_machine.cap_lang.html#Seq"><span class="id" title="constructor">Seq</span></a> (<a class="idref" href="cap_machine.cap_lang.html#Instr"><span class="id" title="constructor">Instr</span></a> <a class="idref" href="cap_machine.cap_lang.html#Executable"><span class="id" title="constructor">Executable</span></a>) <span class="id" title="notation">{{</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#de6e3fe6143317c8657dfe79764a6915"><span class="id" title="variable">φ</span></a> <span class="id" title="notation">}}</span><span class="id" title="notation">)</span><span class="id" title="notation">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">-∗</span> <span class="id" title="notation">WP</span> <a class="idref" href="cap_machine.cap_lang.html#Seq"><span class="id" title="constructor">Seq</span></a> (<a class="idref" href="cap_machine.cap_lang.html#Instr"><span class="id" title="constructor">Instr</span></a> <a class="idref" href="cap_machine.cap_lang.html#Executable"><span class="id" title="constructor">Executable</span></a>) <span class="id" title="notation">{{</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#de6e3fe6143317c8657dfe79764a6915"><span class="id" title="variable">φ</span></a> <span class="id" title="notation">}}</span>)%<span class="id" title="var">I</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> (<span class="id" title="tactic">try</span> <span class="id" title="var">solve_addr'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;`Proof&nbsp;with`&nbsp;will&nbsp;replace&nbsp;each&nbsp;`...`&nbsp;by&nbsp;`try&nbsp;solve_addr'`&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">e_prog</span> <span class="id" title="var">a_secret</span> <span class="id" title="var">Hpc_perm</span> <span class="id" title="var">Hpc_bounds</span> <span class="id" title="var">Hsecret_bounds</span> <span class="id" title="var">Hp_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(HPC &amp; Hr_mem &amp; Hr2 &amp; Hr3 &amp; Hmem &amp; Hprog &amp; Post)".<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="cap_machine.proofmode.region.html#region_mapsto"><span class="id" title="definition">region_mapsto</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">codefrag_facts</span> "Hprog".<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iGo'</span> "Hprog".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">transitivity</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<span class="id" title="var">b_mem</span> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <span class="id" title="var">secret_off</span>)%<span class="id" title="var">a</span>)... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> -&gt;; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hp_mem</span>; <span class="id" title="tactic">discriminate</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes_split"><span class="id" title="axiom">region_addrs_zeroes_split</span></a> <span class="id" title="var">b_mem</span> <span class="id" title="var">a_secret</span> <span class="id" title="var">e_mem</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="cap_machine.proofmode.region.html#region_mapsto_split"><span class="id" title="axiom">region_mapsto_split</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">b_mem</span> <span class="id" title="var">e_mem</span> <span class="id" title="var">a_secret</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a> <span class="id" title="var">b_mem</span> <span class="id" title="var">a_secret</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a> <span class="id" title="var">a_secret</span> <span class="id" title="var">e_mem</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">with</span> "Hmem"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "[Hmem Hmem']"...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">unfold</span> <a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">replicate_length</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a> <span class="id" title="tactic">at</span> 4.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="machine_utils.finz_interval.html#finz_dist_S"><span class="id" title="lemma">finz_dist_S</span></a>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">replicate_S</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="cap_machine.proofmode.region.html#region_mapsto_cons"><span class="id" title="axiom">region_mapsto_cons</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a_secret</span> (<span class="id" title="var">a_secret</span> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> 1)%<span class="id" title="var">a</span> <span class="id" title="var">e_mem</span> (<a class="idref" href="cap_machine.machine_base.html#WInt"><span class="id" title="constructor">WInt</span></a> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a> <span class="id" title="var">_</span> <span class="id" title="var">e_mem</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">with</span> "Hmem'"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "[Hsecret Hmem']"...<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;getB&nbsp;getE&nbsp;add&nbsp;subseg&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iGo'</span> "Hprog".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">transitivity</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<span class="id" title="var">b_mem</span> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">(</span></a><span class="id" title="var">secret_off</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1<a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">a</span>)... }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> -&gt;; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hp_mem</span>; <span class="id" title="tactic">discriminate</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">solve_addr'</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Post&nbsp;condition&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> "Post".<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">e_prog</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">b_mem</span> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">(</span></a><span class="id" title="var">secret_off</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1<a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">a</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">a_secret</span> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> 1)%<span class="id" title="var">a</span> <span class="id" title="tactic">by</span> <span class="id" title="var">solve_addr'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">b_mem</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">secret_off</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1) <span class="id" title="keyword">with</span> (<span class="id" title="var">b_mem</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">(</span></a><span class="id" title="var">secret_off</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">)</span></a>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iFrame</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Unshelve</span>. <span class="id" title="var">Fail</span> <span class="id" title="tactic">idtac</span>. <span class="id" title="var">Admitted</span>.<br/>

<br/>
</div>

<div class="doc">
Specification of the program until the jump to the unknown adversary code 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="prog_spec_CPS" class="idref" href="#prog_spec_CPS"><span class="id" title="lemma">prog_spec_CPS</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="wadv:45" class="idref" href="#wadv:45"><span class="id" title="binder">wadv</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="p_pc:46" class="idref" href="#p_pc:46"><span class="id" title="binder">p_pc</span></a> <a id="b_pc:47" class="idref" href="#b_pc:47"><span class="id" title="binder">b_pc</span></a> <a id="e_pc:48" class="idref" href="#e_pc:48"><span class="id" title="binder">e_pc</span></a> <a id="a_prog:49" class="idref" href="#a_prog:49"><span class="id" title="binder">a_prog</span></a> <span class="comment">(*&nbsp;pc&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="p_mem:50" class="idref" href="#p_mem:50"><span class="id" title="binder">p_mem</span></a> (<a id="b_mem:51" class="idref" href="#b_mem:51"><span class="id" title="binder">b_mem</span></a> <a id="e_mem:52" class="idref" href="#e_mem:52"><span class="id" title="binder">e_mem</span></a> : <a class="idref" href="cap_machine.addr_reg.html#Addr"><span class="id" title="abbreviation">Addr</span></a>) <span class="comment">(*&nbsp;mem&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="w2:53" class="idref" href="#w2:53"><span class="id" title="binder">w2</span></a> <a id="w3:54" class="idref" href="#w3:54"><span class="id" title="binder">w3</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="secret_off:55" class="idref" href="#secret_off:55"><span class="id" title="binder">secret_off</span></a> <a id="secret_val:56" class="idref" href="#secret_val:56"><span class="id" title="binder">secret_val</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="446d542474945d9a4049ff0cab088f3f" class="idref" href="#446d542474945d9a4049ff0cab088f3f"><span class="id" title="binder">φ</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="secret:58" class="idref" href="#secret:58"><span class="id" title="binder">secret</span></a> := (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:51"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:55"><span class="id" title="variable">secret_off</span></a>)%<span class="id" title="var">a</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="len_p:59" class="idref" href="#len_p:59"><span class="id" title="binder">len_p</span></a> := (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_prog:49"><span class="id" title="variable">a_prog</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <span class="id" title="abbreviation">length</span> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#prog_code"><span class="id" title="definition">prog_code</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:55"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_val:56"><span class="id" title="variable">secret_val</span></a>))%<span class="id" title="var">a</span> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cap_machine.machine_base.html#ExecPCPerm"><span class="id" title="definition">ExecPCPerm</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#p_pc:46"><span class="id" title="variable">p_pc</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="machine_utils.finz_base.html#SubBounds"><span class="id" title="definition">SubBounds</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_pc:47"><span class="id" title="variable">b_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_pc:48"><span class="id" title="variable">e_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_prog:49"><span class="id" title="variable">a_prog</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#len_p:59"><span class="id" title="variable">len_p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:51"><span class="id" title="variable">b_mem</span></a> <span class="id" title="notation">≤</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:58"><span class="id" title="variable">secret</span></a> <span class="id" title="notation">&lt;</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:52"><span class="id" title="variable">e_mem</span></a>)%<span class="id" title="var">a</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cap_machine.machine_base.html#writeAllowed"><span class="id" title="definition">writeAllowed</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#p_mem:50"><span class="id" title="variable">p_mem</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">⊢</span> ( <span class="comment">(*&nbsp;PC&nbsp;points&nbsp;to&nbsp;prog_code*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">(</span> <a class="idref" href="cap_machine.addr_reg.html#PC"><span class="id" title="constructor">PC</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.machine_base.html#WCap"><span class="id" title="abbreviation">WCap</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#p_pc:46"><span class="id" title="variable">p_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_pc:47"><span class="id" title="variable">b_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_pc:48"><span class="id" title="variable">e_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_prog:49"><span class="id" title="variable">a_prog</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.proofmode.region.html#codefrag"><span class="id" title="definition">codefrag</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_prog:49"><span class="id" title="variable">a_prog</span></a> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#prog_code"><span class="id" title="definition">prog_code</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:55"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_val:56"><span class="id" title="variable">secret_val</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;r1&nbsp;points&nbsp;to&nbsp;the&nbsp;allocated&nbsp;memory*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.addr_reg.html#r_t1"><span class="id" title="definition">r_t1</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.machine_base.html#WCap"><span class="id" title="abbreviation">WCap</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#p_mem:50"><span class="id" title="variable">p_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:51"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:52"><span class="id" title="variable">e_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:51"><span class="id" title="variable">b_mem</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;which&nbsp;is&nbsp;filled&nbsp;by&nbsp;zeroes&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">[[</span></a><a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:51"><span class="id" title="variable">b_mem</span></a><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">,</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:52"><span class="id" title="variable">e_mem</span></a><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">]]</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">↦ₐ</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">[[</span></a> <a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:51"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:52"><span class="id" title="variable">e_mem</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">]]</span></a><br/>
          <span class="comment">(*&nbsp;r30&nbsp;point&nbsp;to&nbsp;the&nbsp;adversary&nbsp;code&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.addr_reg.html#r_t30"><span class="id" title="definition">r_t30</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#wadv:45"><span class="id" title="variable">wadv</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.addr_reg.html#r_t2"><span class="id" title="definition">r_t2</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#w2:53"><span class="id" title="variable">w2</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.addr_reg.html#r_t3"><span class="id" title="definition">r_t3</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#w3:54"><span class="id" title="variable">w3</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <span class="id" title="notation">▷</span> <span class="id" title="notation">(</span> <a class="idref" href="cap_machine.addr_reg.html#PC"><span class="id" title="constructor">PC</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.machine_base.html#updatePcPerm"><span class="id" title="definition">updatePcPerm</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#wadv:45"><span class="id" title="variable">wadv</span></a> <span class="comment">(*&nbsp;The&nbsp;specification&nbsp;stops&nbsp;after&nbsp;the&nbsp;jump&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.addr_reg.html#r_t1"><span class="id" title="definition">r_t1</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.machine_base.html#WCap"><span class="id" title="abbreviation">WCap</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#p_mem:50"><span class="id" title="variable">p_mem</span></a> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:51"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">(</span></a><a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:55"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1<a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">a</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:52"><span class="id" title="variable">e_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:58"><span class="id" title="variable">secret</span></a>%<span class="id" title="var">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.addr_reg.html#r_t2"><span class="id" title="definition">r_t2</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.machine_base.html#WInt"><span class="id" title="constructor">WInt</span></a> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:51"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">(</span></a><a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:55"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">)</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.addr_reg.html#r_t3"><span class="id" title="definition">r_t3</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.machine_base.html#WInt"><span class="id" title="constructor">WInt</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:52"><span class="id" title="variable">e_mem</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.addr_reg.html#r_t30"><span class="id" title="definition">r_t30</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#wadv:45"><span class="id" title="variable">wadv</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.proofmode.region.html#codefrag"><span class="id" title="definition">codefrag</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_prog:49"><span class="id" title="variable">a_prog</span></a> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#prog_code"><span class="id" title="definition">prog_code</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:55"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_val:56"><span class="id" title="variable">secret_val</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">[[</span></a>(<a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:58"><span class="id" title="variable">secret</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> 1)%<span class="id" title="var">a</span><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">,</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:52"><span class="id" title="variable">e_mem</span></a><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">]]</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">↦ₐ</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">[[</span></a> <a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:58"><span class="id" title="variable">secret</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> 1)%<span class="id" title="var">a</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:52"><span class="id" title="variable">e_mem</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">]]</span></a><br/>
                <span class="id" title="notation">-∗</span> <span class="id" title="notation">WP</span> <a class="idref" href="cap_machine.cap_lang.html#Seq"><span class="id" title="constructor">Seq</span></a> (<a class="idref" href="cap_machine.cap_lang.html#Instr"><span class="id" title="constructor">Instr</span></a> <a class="idref" href="cap_machine.cap_lang.html#Executable"><span class="id" title="constructor">Executable</span></a>) <span class="id" title="notation">{{</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#446d542474945d9a4049ff0cab088f3f"><span class="id" title="variable">φ</span></a> <span class="id" title="notation">}}</span><span class="id" title="notation">)</span><span class="id" title="notation">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">-∗</span> <span class="id" title="notation">WP</span> <a class="idref" href="cap_machine.cap_lang.html#Seq"><span class="id" title="constructor">Seq</span></a> (<a class="idref" href="cap_machine.cap_lang.html#Instr"><span class="id" title="constructor">Instr</span></a> <a class="idref" href="cap_machine.cap_lang.html#Executable"><span class="id" title="constructor">Executable</span></a>) <span class="id" title="notation">{{</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#446d542474945d9a4049ff0cab088f3f"><span class="id" title="variable">φ</span></a> <span class="id" title="notation">}}</span>)%<span class="id" title="var">I</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">Hpc_perm</span> <span class="id" title="var">Hpc_bounds</span> <span class="id" title="var">Hlen_mem</span> <span class="id" title="var">Hp_mem</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(HPC &amp; Hprog &amp; Hr1 &amp; Hmem &amp; Hr30 &amp; Hr2 &amp; Hr3 &amp; Post)".<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="cap_machine.exercises.subseg_buffer.html#prog_code"><span class="id" title="definition">prog_code</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">codefrag_facts</span> "Hprog".<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">focus_block_0</span> "Hprog" <span class="id" title="keyword">as</span> "Hprog" "Hcont".<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;1&nbsp;-&nbsp;Specification&nbsp;from&nbsp;Lea&nbsp;to&nbsp;Subsug&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="cap_machine.exercises.subseg_buffer.html#prog_base_spec"><span class="id" title="axiom">prog_base_spec</span></a> <span class="id" title="notation">with</span> "[-]"<span class="id" title="notation">)</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">last</span> <span class="id" title="var">iFrame</span>; <span class="id" title="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span> <span class="id" title="var">solve_addr'</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!&gt; (HPC &amp; Hr1 &amp; Hr2 &amp; Hr3 &amp; Hmem &amp; Hsecret &amp; Hmem' &amp; Hprog)".<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unfocus_block</span> "Hprog" "Hcont" <span class="id" title="keyword">as</span> "Hprog".<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;2&nbsp;-&nbsp;Jump&nbsp;to&nbsp;the&nbsp;adversary&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;jmp&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iInstr</span> "Hprog".<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;3&nbsp;-&nbsp;Post&nbsp;condition&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> "Post".<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">secret</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">(</span></a><span class="id" title="var">b_mem</span> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <span class="id" title="var">secret_off</span><a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">)</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> 1)%<span class="id" title="var">a</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">b_mem</span> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">(</span></a><span class="id" title="var">secret_off</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1<a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">a</span> <span class="id" title="tactic">by</span> <span class="id" title="var">solve_addr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span>  (<span class="id" title="var">b_mem</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <span class="id" title="var">secret_off</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1)%<span class="id" title="var">Z</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">b_mem</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">(</span></a><span class="id" title="var">secret_off</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">Z</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iFrame</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Unshelve</span>. <span class="id" title="var">Fail</span> <span class="id" title="tactic">idtac</span>. <span class="id" title="var">Admitted</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<a id="nainv:60" class="idref" href="#nainv:60"><span class="id" title="binder">nainv</span></a>: <a class="idref" href="cap_machine.logrel.html#logrel_na_invs"><span class="id" title="class">logrel_na_invs</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#413be6df3163c4b60aef9a6745e0d91a"><span class="id" title="variable">Σ</span></a>}.<br/>

<br/>
</div>

<div class="doc">
Assuming that the word of the adversary is safe to share,
     the machine executes safely and completely.
     The assumption makes sense, because we consider adversary programs containing
     no capabilities. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="prog_spec_CPS_full" class="idref" href="#prog_spec_CPS_full"><span class="id" title="lemma">prog_spec_CPS_full</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="p_pc:61" class="idref" href="#p_pc:61"><span class="id" title="binder">p_pc</span></a> <a id="b_pc:62" class="idref" href="#b_pc:62"><span class="id" title="binder">b_pc</span></a> <a id="e_pc:63" class="idref" href="#e_pc:63"><span class="id" title="binder">e_pc</span></a> <a id="a_prog:64" class="idref" href="#a_prog:64"><span class="id" title="binder">a_prog</span></a> <span class="comment">(*&nbsp;pc&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="p_mem:65" class="idref" href="#p_mem:65"><span class="id" title="binder">p_mem</span></a> (<a id="b_mem:66" class="idref" href="#b_mem:66"><span class="id" title="binder">b_mem</span></a> <a id="e_mem:67" class="idref" href="#e_mem:67"><span class="id" title="binder">e_mem</span></a> : <a class="idref" href="cap_machine.addr_reg.html#Addr"><span class="id" title="abbreviation">Addr</span></a>) <span class="comment">(*&nbsp;mem&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="w_adv:68" class="idref" href="#w_adv:68"><span class="id" title="binder">w_adv</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="secret_off:69" class="idref" href="#secret_off:69"><span class="id" title="binder">secret_off</span></a> <a id="secret_val:70" class="idref" href="#secret_val:70"><span class="id" title="binder">secret_val</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a id="rmap:71" class="idref" href="#rmap:71"><span class="id" title="binder">rmap</span></a> :<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="secret:72" class="idref" href="#secret:72"><span class="id" title="binder">secret</span></a> := (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:66"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:69"><span class="id" title="variable">secret_off</span></a>)%<span class="id" title="var">a</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="len_p:73" class="idref" href="#len_p:73"><span class="id" title="binder">len_p</span></a> := (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_prog:64"><span class="id" title="variable">a_prog</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <span class="id" title="abbreviation">length</span> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#prog_code"><span class="id" title="definition">prog_code</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:69"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_val:70"><span class="id" title="variable">secret_val</span></a>))%<span class="id" title="var">a</span> <span class="id" title="tactic">in</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Validity&nbsp;PC*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cap_machine.machine_base.html#ExecPCPerm"><span class="id" title="definition">ExecPCPerm</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#p_pc:61"><span class="id" title="variable">p_pc</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="machine_utils.finz_base.html#SubBounds"><span class="id" title="definition">SubBounds</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_pc:62"><span class="id" title="variable">b_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_pc:63"><span class="id" title="variable">e_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_prog:64"><span class="id" title="variable">a_prog</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#len_p:73"><span class="id" title="variable">len_p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Validity&nbsp;buffer&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:66"><span class="id" title="variable">b_mem</span></a> <span class="id" title="notation">≤</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:72"><span class="id" title="variable">secret</span></a> <span class="id" title="notation">&lt;</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:67"><span class="id" title="variable">e_mem</span></a>)%<span class="id" title="var">a</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="cap_machine.machine_base.html#writeAllowed"><span class="id" title="definition">writeAllowed</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#p_mem:65"><span class="id" title="variable">p_mem</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Register&nbsp;map&nbsp;for&nbsp;the&nbsp;big_sep&nbsp;of&nbsp;registers&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">dom</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#rmap:71"><span class="id" title="variable">rmap</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cap_machine.addr_reg.html#all_registers_s"><span class="id" title="definition">all_registers_s</span></a> <span class="id" title="notation">∖</span> <span class="id" title="notation">{[</span> <a class="idref" href="cap_machine.addr_reg.html#PC"><span class="id" title="constructor">PC</span></a><span class="id" title="notation">;</span> <a class="idref" href="cap_machine.addr_reg.html#r_t1"><span class="id" title="definition">r_t1</span></a><span class="id" title="notation">;</span> <a class="idref" href="cap_machine.addr_reg.html#r_t30"><span class="id" title="definition">r_t30</span></a> <span class="id" title="notation">]}</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">⊢</span> ( <a class="idref" href="cap_machine.addr_reg.html#PC"><span class="id" title="constructor">PC</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.machine_base.html#WCap"><span class="id" title="abbreviation">WCap</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#p_pc:61"><span class="id" title="variable">p_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_pc:62"><span class="id" title="variable">b_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_pc:63"><span class="id" title="variable">e_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_prog:64"><span class="id" title="variable">a_prog</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.addr_reg.html#r_t1"><span class="id" title="definition">r_t1</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.machine_base.html#WCap"><span class="id" title="abbreviation">WCap</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#p_mem:65"><span class="id" title="variable">p_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:66"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:67"><span class="id" title="variable">e_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:66"><span class="id" title="variable">b_mem</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.addr_reg.html#r_t30"><span class="id" title="definition">r_t30</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#w_adv:68"><span class="id" title="variable">w_adv</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.proofmode.region.html#codefrag"><span class="id" title="definition">codefrag</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_prog:64"><span class="id" title="variable">a_prog</span></a> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#prog_code"><span class="id" title="definition">prog_code</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:69"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_val:70"><span class="id" title="variable">secret_val</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">[[</span></a><a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:66"><span class="id" title="variable">b_mem</span></a><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">,</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:67"><span class="id" title="variable">e_mem</span></a><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">]]</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">↦ₐ</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">[[</span></a> <a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:66"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:67"><span class="id" title="variable">e_mem</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">]]</span></a><br/>
          <span class="comment">(*&nbsp;All&nbsp;the&nbsp;registers&nbsp;contains&nbsp;integers&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <span class="id" title="notation">(</span><span class="id" title="notation">[∗</span> <span class="id" title="notation">map</span><span class="id" title="notation">]</span> <a id="r:74" class="idref" href="#r:74"><span class="id" title="binder"><span id="r:75" class="id">r</span></span></a><span class="id" title="notation">↦</span><a id="w:76" class="idref" href="#w:76"><span class="id" title="binder"><span id="w:77" class="id">w</span></span></a> <span class="id" title="notation">∈</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#rmap:71"><span class="id" title="variable">rmap</span></a><span class="id" title="notation">,</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#r:74"><span class="id" title="variable">r</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#w:76"><span class="id" title="variable">w</span></a> <span class="id" title="notation">∗</span> <span class="id" title="notation">⌜</span><a class="idref" href="cap_machine.machine_base.html#is_z"><span class="id" title="definition">is_z</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#w:76"><span class="id" title="variable">w</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a><span class="id" title="notation">⌝</span><span class="id" title="notation">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;NA&nbsp;token&nbsp;is&nbsp;required&nbsp;for&nbsp;the&nbsp;post&nbsp;condition&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <span class="id" title="definition">na_own</span> <a class="idref" href="cap_machine.logrel.html#logrel_nais"><span class="id" title="method">logrel_nais</span></a> <span class="id" title="notation">⊤</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;adversary&nbsp;word&nbsp;is&nbsp;safe&nbsp;to&nbsp;share&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.logrel.html#interp"><span class="id" title="definition">interp</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#w_adv:68"><span class="id" title="variable">w_adv</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Post&nbsp;condition&nbsp;of&nbsp;the&nbsp;corollary&nbsp;of&nbsp;the&nbsp;FTLR&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">-∗</span> <span class="id" title="notation">WP</span> <a class="idref" href="cap_machine.cap_lang.html#Seq"><span class="id" title="constructor">Seq</span></a> (<a class="idref" href="cap_machine.cap_lang.html#Instr"><span class="id" title="constructor">Instr</span></a> <a class="idref" href="cap_machine.cap_lang.html#Executable"><span class="id" title="constructor">Executable</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">{{</span> <a id="v:78" class="idref" href="#v:78"><span class="id" title="binder">v</span></a><span class="id" title="notation">,</span> <span class="id" title="notation">⌜</span><a class="idref" href="cap_machine.exercises.subseg_buffer.html#v:78"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="cap_machine.cap_lang.html#HaltedV"><span class="id" title="constructor">HaltedV</span></a><span class="id" title="notation">⌝</span> <span class="id" title="notation">→</span> <span class="comment">(*&nbsp;if&nbsp;the&nbsp;machine&nbsp;halts&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;we&nbsp;own&nbsp;all&nbsp;the&nbsp;registers&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∃</span> <a id="r:79" class="idref" href="#r:79"><span class="id" title="binder">r</span></a> : <a class="idref" href="cap_machine.machine_base.html#Reg"><span class="id" title="definition">Reg</span></a><span class="id" title="notation">,</span> <a class="idref" href="cap_machine.logrel.html#full_map"><span class="id" title="definition">full_map</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#r:79"><span class="id" title="variable">r</span></a> <span class="id" title="notation">∧</span> <a class="idref" href="cap_machine.logrel.html#registers_mapsto"><span class="id" title="definition">registers_mapsto</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#r:79"><span class="id" title="variable">r</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;all&nbsp;the&nbsp;NA&nbsp;invariants&nbsp;are&nbsp;closed*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <span class="id" title="definition">na_own</span> <a class="idref" href="cap_machine.logrel.html#logrel_nais"><span class="id" title="method">logrel_nais</span></a> <span class="id" title="notation">⊤</span><span class="id" title="notation">}}</span>)%<span class="id" title="var">I</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">Hpc_perm</span> <span class="id" title="var">Hpc_bounds</span> <span class="id" title="var">Hvsecret</span> <span class="id" title="var">Hp_mem</span> <span class="id" title="var">Hrmap_dom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "(HPC &amp; Hr1 &amp; Hr30 &amp; Hprog &amp; Hregion &amp; Hrmap &amp; Hna &amp; #Hadv)".<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Using&nbsp;the&nbsp;FLTR&nbsp;corollary,&nbsp;w_adv&nbsp;is&nbsp;safe&nbsp;to&nbsp;execute&nbsp;and&nbsp;we&nbsp;can&nbsp;specify<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;what&nbsp;happens&nbsp;after&nbsp;the&nbsp;jump:&nbsp;safe&nbsp;and&nbsp;complete&nbsp;execution&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;It&nbsp;is&nbsp;required&nbsp;to&nbsp;do&nbsp;it&nbsp;_before_&nbsp;the&nbsp;specification,&nbsp;because&nbsp;it&nbsp;introduces&nbsp;a<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;later&nbsp;modality&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="cap_machine.fundamental.html#jmp_to_unknown"><span class="id" title="axiom">jmp_to_unknown</span></a> <span class="id" title="notation">with</span> "Hadv"<span class="id" title="notation">)</span> <span class="id" title="keyword">as</span> "Cont".<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;1&nbsp;-&nbsp;Specification&nbsp;of&nbsp;the&nbsp;known&nbsp;program&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Extract&nbsp;the&nbsp;register&nbsp;r_t2&nbsp;and&nbsp;r_t3,&nbsp;required&nbsp;for&nbsp;`prog_spec_CPS`&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iExtractList</span> "Hrmap" <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a><a class="idref" href="cap_machine.addr_reg.html#r_t2"><span class="id" title="definition">r_t2</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a> <a class="idref" href="cap_machine.addr_reg.html#r_t3"><span class="id" title="definition">r_t3</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a> <span class="id" title="keyword">as</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a>"[Hr2 _]"<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a> "[Hr3 _]"<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><a class="idref" href="cap_machine.exercises.subseg_buffer.html#prog_spec_CPS"><span class="id" title="axiom">prog_spec_CPS</span></a> <span class="id" title="notation">with</span> "[-]"<span class="id" title="notation">)</span>; [ <span class="id" title="var">eassumption</span> .. |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iFrame</span> "HPC Hr1 Hr30 Hregion Hr2 Hr3 Hprog".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!&gt; (HPC &amp; Hr1 &amp; Hr2 &amp; Hr3 &amp; Hr30 &amp; Hprog &amp; Hmem)".<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;2&nbsp;-&nbsp;The&nbsp;continuation&nbsp;requires&nbsp;all&nbsp;the&nbsp;registers&nbsp;to&nbsp;be&nbsp;safe&nbsp;to&nbsp;share&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Show&nbsp;that&nbsp;the&nbsp;contents&nbsp;of&nbsp;r1&nbsp;are&nbsp;safe&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">(</span></a><span class="id" title="var">b_mem</span> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <span class="id" title="var">secret_off</span><a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">)</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> 1)%<span class="id" title="var">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> (<span class="id" title="var">b_mem</span> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">(</span></a><span class="id" title="var">secret_off</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1<a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">a</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">subst</span> <span class="id" title="var">secret</span>; <span class="id" title="tactic">by</span> <span class="id" title="var">solve_addr</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="cap_machine.proofmode.region.html#region_mapsto"><span class="id" title="definition">region_mapsto</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <span class="id" title="notation">(</span><a class="idref" href="cap_machine.fundamental.html#region_integers_alloc'"><span class="id" title="axiom">region_integers_alloc'</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">b_mem</span> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <span class="id" title="var">secret_off</span>)%<span class="id" title="var">a</span> <span class="id" title="var">_</span> <span class="id" title="var">p_mem</span> <span class="id" title="notation">with</span> "Hmem"<span class="id" title="notation">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> "&gt;#Hmem_safe".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> /<a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">Forall_replicate</span>. <span class="id" title="tactic">auto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;put&nbsp;the&nbsp;other&nbsp;registers&nbsp;back&nbsp;into&nbsp;the&nbsp;register&nbsp;map&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssert</span> ( <span class="id" title="notation">⌜</span><a class="idref" href="cap_machine.machine_base.html#is_z"><span class="id" title="definition">is_z</span></a> (<a class="idref" href="cap_machine.machine_base.html#WInt"><span class="id" title="constructor">WInt</span></a> (<span class="id" title="var">b_mem</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">(</span></a><span class="id" title="var">secret_off</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1<a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">)</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <span class="id" title="notation">⌝</span>)%<span class="id" title="var">I</span> <span class="id" title="keyword">as</span> "Hvr2"; <span class="id" title="tactic">first</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iCombine</span> "Hr2 Hvr2" <span class="id" title="keyword">as</span> "Hr2".<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssert</span> ( <span class="id" title="notation">⌜</span><a class="idref" href="cap_machine.machine_base.html#is_z"><span class="id" title="definition">is_z</span></a> (<a class="idref" href="cap_machine.machine_base.html#WInt"><span class="id" title="constructor">WInt</span></a> <span class="id" title="var">e_mem</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <span class="id" title="notation">⌝</span>)%<span class="id" title="var">I</span> <span class="id" title="keyword">as</span> "Hvr3"; <span class="id" title="tactic">first</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iCombine</span> "Hr3 Hvr3" <span class="id" title="keyword">as</span> "Hr3".<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iInsertList</span> "Hrmap" <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a><a class="idref" href="cap_machine.addr_reg.html#r_t3"><span class="id" title="definition">r_t3</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a> <a class="idref" href="cap_machine.addr_reg.html#r_t2"><span class="id" title="definition">r_t2</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a>. <span class="id" title="var">iClear</span> "Hvr2 Hvr3".<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Show&nbsp;that&nbsp;the&nbsp;contents&nbsp;of&nbsp;unused&nbsp;registers&nbsp;is&nbsp;safe&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">rmap'</span> := <span class="id" title="notation">&lt;[</span><a class="idref" href="cap_machine.addr_reg.html#r_t2"><span class="id" title="definition">r_t2</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="cap_machine.machine_base.html#WInt"><span class="id" title="constructor">WInt</span></a> <span class="id" title="var">_</span><span class="id" title="notation">]&gt;</span> <span class="id" title="notation">(&lt;[</span><span class="id" title="notation">r_t3</span> <span class="id" title="notation">:=</span> <span class="id" title="notation">_</span><span class="id" title="notation">]&gt;</span> <span class="id" title="notation">rmap</span><span class="id" title="notation">)</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssert</span> (<span class="id" title="notation">[∗</span> <span class="id" title="notation">map</span><span class="id" title="notation">]</span> <a id="r:80" class="idref" href="#r:80"><span class="id" title="binder"><span id="r:81" class="id"><span id="r:84" class="id"><span id="r:85" class="id">r</span></span></span></span></a><span class="id" title="notation">↦</span><a id="w:82" class="idref" href="#w:82"><span class="id" title="binder"><span id="w:83" class="id"><span id="w:86" class="id"><span id="w:87" class="id">w</span></span></span></span></a> <span class="id" title="notation">∈</span> <span class="id" title="var">rmap'</span><span class="id" title="notation">,</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#r:80"><span class="id" title="variable">r</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#db884c99aed36a9ddaddcd7edc424755"><span class="id" title="notation">↦ᵣ</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#w:82"><span class="id" title="variable">w</span></a> <span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.logrel.html#interp"><span class="id" title="definition">interp</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#w:82"><span class="id" title="variable">w</span></a>)%<span class="id" title="var">I</span> <span class="id" title="keyword">with</span> "[Hrmap]" <span class="id" title="keyword">as</span> "Hrmap".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">subst</span> <span class="id" title="var">rmap'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <span class="id" title="notation">(</span><span class="id" title="lemma">big_sepM_mono</span> <span class="id" title="notation">with</span> "Hrmap"<span class="id" title="notation">)</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">r</span> <span class="id" title="var">w</span> <span class="id" title="var">Hr'</span>) "[$ %Hw]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_word</span> <span class="id" title="var">w</span>; [| <span class="id" title="tactic">by</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hw</span> .. ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="cap_machine.logrel.html#fixpoint_interp1_eq"><span class="id" title="lemma">fixpoint_interp1_eq</span></a> //. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;put&nbsp;the&nbsp;registers&nbsp;with&nbsp;capability&nbsp;back&nbsp;into&nbsp;the&nbsp;register&nbsp;map&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iCombine</span> "Hr1 Hmem_safe" <span class="id" title="keyword">as</span> "Hr1".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iCombine</span> "Hr30 Hadv" <span class="id" title="keyword">as</span> "Hr30".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">rmap'</span>; <span class="id" title="var">iInsertList</span> "Hrmap" <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">[</span></a><a class="idref" href="cap_machine.addr_reg.html#r_t1"><span class="id" title="definition">r_t1</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">;</span></a><a class="idref" href="cap_machine.addr_reg.html#r_t30"><span class="id" title="definition">r_t30</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Lists.List.html#e76c6291366b599375c28eba0aae94bb"><span class="id" title="notation">]</span></a>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;3&nbsp;-&nbsp;Use&nbsp;the&nbsp;continuation&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Prepare&nbsp;the&nbsp;resources&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> "Cont"; [| <span class="id" title="var">iFrame</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iPureIntro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="lemma">dom_insert_L</span> <span class="id" title="var">Hrmap_dom</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="lemma">singleton_union_difference_L</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">set_solver</span>+.<br/>
&nbsp;&nbsp;<span class="id" title="var">Unshelve</span>. <span class="id" title="var">Fail</span> <span class="id" title="tactic">idtac</span>. <span class="id" title="var">Admitted</span>.<br/>

<br/>
</div>

<div class="doc">
The encapsulation of the program is safe-to-share
    By unfolding the definition of V(E,-,-,-) , we can use only persistent
    proposition. Thus, all the required resources of the memory have to be
    encapsulated in invariants. 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="N" class="idref" href="#N"><span class="id" title="definition">N</span></a> : <span class="id" title="definition">namespace</span> := <span class="id" title="definition">nroot</span> <span class="id" title="notation">.@</span> "secret".<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="start_memN" class="idref" href="#start_memN"><span class="id" title="definition">start_memN</span></a> := (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#N"><span class="id" title="definition">N</span></a><span class="id" title="notation">.@</span>"start_mem").<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="secretN" class="idref" href="#secretN"><span class="id" title="definition">secretN</span></a> := (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#N"><span class="id" title="definition">N</span></a><span class="id" title="notation">.@</span>"secret").<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="end_memN" class="idref" href="#end_memN"><span class="id" title="definition">end_memN</span></a> := (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#N"><span class="id" title="definition">N</span></a><span class="id" title="notation">.@</span>"end_mem").<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="codeN" class="idref" href="#codeN"><span class="id" title="definition">codeN</span></a> := (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#N"><span class="id" title="definition">N</span></a><span class="id" title="notation">.@</span>"code").<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;first&nbsp;part&nbsp;of&nbsp;the&nbsp;buffer,&nbsp;before&nbsp;the&nbsp;secret,&nbsp;is&nbsp;always&nbsp;zeroes&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="start_mem_inv" class="idref" href="#start_mem_inv"><span class="id" title="definition">start_mem_inv</span></a> (<a id="b_mem:88" class="idref" href="#b_mem:88"><span class="id" title="binder">b_mem</span></a> <a id="e_mem:89" class="idref" href="#e_mem:89"><span class="id" title="binder">e_mem</span></a> : <a class="idref" href="cap_machine.addr_reg.html#Addr"><span class="id" title="abbreviation">Addr</span></a>) <a id="secret_off:90" class="idref" href="#secret_off:90"><span class="id" title="binder">secret_off</span></a>:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="secret_addr:91" class="idref" href="#secret_addr:91"><span class="id" title="binder">secret_addr</span></a> := (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:88"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:90"><span class="id" title="variable">secret_off</span></a>)%<span class="id" title="var">a</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">na_inv</span> <a class="idref" href="cap_machine.logrel.html#logrel_nais"><span class="id" title="method">logrel_nais</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#start_memN"><span class="id" title="definition">start_memN</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">[[</span></a><a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:88"><span class="id" title="variable">b_mem</span></a><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">,</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_addr:91"><span class="id" title="variable">secret_addr</span></a><a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">]]</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">↦ₐ</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">[[</span></a> <a class="idref" href="cap_machine.examples.addr_reg_sample.html#region_addrs_zeroes"><span class="id" title="definition">region_addrs_zeroes</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:88"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_addr:91"><span class="id" title="variable">secret_addr</span></a> <a class="idref" href="cap_machine.proofmode.region.html#f61454323753175334a2a2859e68823d"><span class="id" title="notation">]]</span></a>).<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;secret&nbsp;is&nbsp;either&nbsp;equal&nbsp;to&nbsp;0&nbsp;--&nbsp;at&nbsp;the&nbsp;initialisation&nbsp;--&nbsp;or&nbsp;equal&nbsp;to<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;42&nbsp;--&nbsp;after&nbsp;the&nbsp;secret&nbsp;was&nbsp;stored&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="secret_inv" class="idref" href="#secret_inv"><span class="id" title="definition">secret_inv</span></a> (<a id="b_mem:92" class="idref" href="#b_mem:92"><span class="id" title="binder">b_mem</span></a> : <a class="idref" href="cap_machine.addr_reg.html#Addr"><span class="id" title="abbreviation">Addr</span></a>) <a id="secret_off:93" class="idref" href="#secret_off:93"><span class="id" title="binder">secret_off</span></a> <a id="secret:94" class="idref" href="#secret:94"><span class="id" title="binder">secret</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="secret_addr:95" class="idref" href="#secret_addr:95"><span class="id" title="binder">secret_addr</span></a> := (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:92"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:93"><span class="id" title="variable">secret_off</span></a>)%<span class="id" title="var">a</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">na_inv</span> <a class="idref" href="cap_machine.logrel.html#logrel_nais"><span class="id" title="method">logrel_nais</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secretN"><span class="id" title="definition">secretN</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="notation">(</span><a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_addr:95"><span class="id" title="variable">secret_addr</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#e389c97555835874498bb08a394266c6"><span class="id" title="notation">↦ₐ</span></a> <a class="idref" href="cap_machine.machine_base.html#WInt"><span class="id" title="constructor">WInt</span></a> 0<span class="id" title="notation">)</span> <span class="id" title="notation">∨</span> <span class="id" title="notation">(</span><a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_addr:95"><span class="id" title="variable">secret_addr</span></a> <a class="idref" href="cap_machine.rules.rules_base.html#e389c97555835874498bb08a394266c6"><span class="id" title="notation">↦ₐ</span></a> <a class="idref" href="cap_machine.machine_base.html#WInt"><span class="id" title="constructor">WInt</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:94"><span class="id" title="variable">secret</span></a><span class="id" title="notation">)</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;code&nbsp;instruction&nbsp;is&nbsp;stored&nbsp;in&nbsp;an&nbsp;invariant&nbsp;as&nbsp;well&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="code_inv" class="idref" href="#code_inv"><span class="id" title="definition">code_inv</span></a> <a id="a_prog:96" class="idref" href="#a_prog:96"><span class="id" title="binder">a_prog</span></a> <a id="secret_off:97" class="idref" href="#secret_off:97"><span class="id" title="binder">secret_off</span></a> <a id="secret:98" class="idref" href="#secret:98"><span class="id" title="binder">secret</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">na_inv</span> <a class="idref" href="cap_machine.logrel.html#logrel_nais"><span class="id" title="method">logrel_nais</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#codeN"><span class="id" title="definition">codeN</span></a> (<a class="idref" href="cap_machine.proofmode.region.html#codefrag"><span class="id" title="definition">codefrag</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_prog:96"><span class="id" title="variable">a_prog</span></a> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#prog_code"><span class="id" title="definition">prog_code</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:97"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:98"><span class="id" title="variable">secret</span></a>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a id="end_mem_inv" class="idref" href="#end_mem_inv"><span class="id" title="definition">end_mem_inv</span></a> <a id="b_mem:99" class="idref" href="#b_mem:99"><span class="id" title="binder">b_mem</span></a> <a id="e_mem:100" class="idref" href="#e_mem:100"><span class="id" title="binder">e_mem</span></a> <a id="secret_off:101" class="idref" href="#secret_off:101"><span class="id" title="binder">secret_off</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <a id="n_secret_addr:102" class="idref" href="#n_secret_addr:102"><span class="id" title="binder">n_secret_addr</span></a> := (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:99"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">(</span></a><a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:101"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1<a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">a</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">na_inv</span> <a class="idref" href="cap_machine.logrel.html#logrel_nais"><span class="id" title="method">logrel_nais</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#end_memN"><span class="id" title="definition">end_memN</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="notation">[∗</span> <span class="id" title="notation">list</span><span class="id" title="notation">]</span> <a id="a:103" class="idref" href="#a:103"><span class="id" title="binder"><span id="a:104" class="id">a</span></span></a> <span class="id" title="notation">∈</span> <a class="idref" href="machine_utils.finz_interval.html#finz.seq_between"><span class="id" title="definition">finz.seq_between</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#n_secret_addr:102"><span class="id" title="variable">n_secret_addr</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:100"><span class="id" title="variable">e_mem</span></a><span class="id" title="notation">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∃</span> <a id="P:105" class="idref" href="#P:105"><span class="id" title="binder">P</span></a><span class="id" title="notation">,</span> <span class="id" title="definition">inv</span> (<a class="idref" href="cap_machine.logrel.html#logN"><span class="id" title="definition">logN</span></a> <span class="id" title="notation">.@</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a:103"><span class="id" title="variable">a</span></a>) (<a class="idref" href="cap_machine.logrel.html#interp_ref_inv"><span class="id" title="definition">interp_ref_inv</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a:103"><span class="id" title="variable">a</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#P:105"><span class="id" title="variable">P</span></a>) <span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.logrel.html#read_cond"><span class="id" title="definition">read_cond</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#P:105"><span class="id" title="variable">P</span></a> <a class="idref" href="cap_machine.logrel.html#interp"><span class="id" title="definition">interp</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.logrel.html#write_cond"><span class="id" title="definition">write_cond</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#P:105"><span class="id" title="variable">P</span></a> <a class="idref" href="cap_machine.logrel.html#interp"><span class="id" title="definition">interp</span></a>)%<span class="id" title="var">I</span>.<br/>

<br/>
</div>

<div class="doc">
Currently, we cannot prove the closure, because we need more information
      about the buffer. Since the closure means "called in any context",
      we cannot assume that the buffer is correctly set up in the context,
      i.e. we cannot assume that the register r1 contains the capability
      pointing to the buffer.

<div class="paragraph"> </div>

      In order to get the right context, we may change our code. Here is 2
      solutions:
<ul class="doclist">
<li> we assume that our program contains a capability pointing to our buffer,
        we need to load the capability in R1 before our program. It corresponds
        to a closure around the code and the buffer

</li>
<li> we dynamically allocate the buffer, by using the `malloc` macro.
        It is different from the previous solution, because it allocates a new
        buffer each time our program is called

</li>
</ul>

<div class="paragraph"> </div>

   
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="prog_CPS_safe_to_share" class="idref" href="#prog_CPS_safe_to_share"><span class="id" title="lemma">prog_CPS_safe_to_share</span></a> <a id="b_pc:106" class="idref" href="#b_pc:106"><span class="id" title="binder">b_pc</span></a> <a id="e_pc:107" class="idref" href="#e_pc:107"><span class="id" title="binder">e_pc</span></a> <a id="a_prog:108" class="idref" href="#a_prog:108"><span class="id" title="binder">a_prog</span></a> (<a id="b_mem:109" class="idref" href="#b_mem:109"><span class="id" title="binder">b_mem</span></a> <a id="e_mem:110" class="idref" href="#e_mem:110"><span class="id" title="binder">e_mem</span></a>: <a class="idref" href="cap_machine.addr_reg.html#Addr"><span class="id" title="abbreviation">Addr</span></a>) <a id="secret_off:111" class="idref" href="#secret_off:111"><span class="id" title="binder">secret_off</span></a> <a id="secret:112" class="idref" href="#secret:112"><span class="id" title="binder">secret</span></a> :<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;instructions&nbsp;of&nbsp;the&nbsp;code&nbsp;are&nbsp;in&nbsp;the&nbsp;memory&nbsp;closure&nbsp;of&nbsp;the&nbsp;PCC&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="machine_utils.finz_base.html#SubBounds"><span class="id" title="definition">SubBounds</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_pc:106"><span class="id" title="variable">b_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_pc:107"><span class="id" title="variable">e_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_prog:108"><span class="id" title="variable">a_prog</span></a> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_prog:108"><span class="id" title="variable">a_prog</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <span class="id" title="abbreviation">length</span> (<a class="idref" href="cap_machine.exercises.subseg_buffer.html#prog_code"><span class="id" title="definition">prog_code</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:111"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:112"><span class="id" title="variable">secret</span></a>))% <span class="id" title="var">a</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;secret&nbsp;offset&nbsp;fits&nbsp;in&nbsp;the&nbsp;memory&nbsp;buffer&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:109"><span class="id" title="variable">b_mem</span></a> <span class="id" title="notation">≤</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:109"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.addr_reg.html#58e53c8acf01fb8822eb5bae448055ec"><span class="id" title="notation">^+</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:111"><span class="id" title="variable">secret_off</span></a> <span class="id" title="notation">&lt;</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:110"><span class="id" title="variable">e_mem</span></a>)%<span class="id" title="var">a</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.18.0/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">⊢</span> <span class="id" title="notation">(</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#code_inv"><span class="id" title="definition">code_inv</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_prog:108"><span class="id" title="variable">a_prog</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:111"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:112"><span class="id" title="variable">secret</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#start_mem_inv"><span class="id" title="definition">start_mem_inv</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:109"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:110"><span class="id" title="variable">e_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:111"><span class="id" title="variable">secret_off</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#end_mem_inv"><span class="id" title="definition">end_mem_inv</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:109"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_mem:110"><span class="id" title="variable">e_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:111"><span class="id" title="variable">secret_off</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">∗</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_inv"><span class="id" title="definition">secret_inv</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_mem:109"><span class="id" title="variable">b_mem</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret_off:111"><span class="id" title="variable">secret_off</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#secret:112"><span class="id" title="variable">secret</span></a><span class="id" title="notation">)</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="notation">-∗</span> <a class="idref" href="cap_machine.logrel.html#interp"><span class="id" title="definition">interp</span></a> (<a class="idref" href="cap_machine.machine_base.html#WCap"><span class="id" title="abbreviation">WCap</span></a> <a class="idref" href="cap_machine.machine_base.html#E"><span class="id" title="constructor">E</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#b_pc:106"><span class="id" title="variable">b_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#e_pc:107"><span class="id" title="variable">e_pc</span></a> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#a_prog:108"><span class="id" title="variable">a_prog</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Abort</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="cap_machine.exercises.subseg_buffer.html#base_program_CPS"><span class="id" title="section">base_program_CPS</span></a>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
